<!DOCTYPE html>
<html>

<head>
    <title>(ArgelH-Subs)</title>
    <link rel="icon" href="https://i.imgur.com/jycGdTy.png" />
    <style>
        html {
            font-family: "Times New Roman", Times, serif;
            font-size: 62.5%;
        }

        body {
            font-size: 3.2rem;
        }
    </style>
</head>

<body>
    <div id="path"></div>
    <div id="contents"></div>

    <script>
        const owner = 'iamargelh';
        const repo = 'ArgelH-Subs';
        const rootFolder = 'subs';
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${rootFolder}`;

        let tree = {};

        async function getTree(path) {
            let response = await fetch(`${apiUrl}${path ? '/' + path : ''}`);
            let data = await response.json();
            let tree = {};
            for (let item of data) {
                if (item.type === 'dir') {
                    tree[item.name] = await getTree(item.path.replace(rootFolder + '/', ''));
                } else {
                    tree[item.name] = item;
                }
            }
            return tree;
        }

        async function init() {
            tree = await getTree();
            showTree(tree);
        }

        function showTree(tree, path = '') {
            let contentsDiv = document.getElementById('contents');
            contentsDiv.innerHTML = '';
            let pathSpan = document.getElementById('path');
            pathSpan.innerHTML = '';
            let parts = path.split('/');
            for (let i in parts) {
                let part = parts[i];
                if (part) {
                    let partSpan = document.createElement('span');
                    partSpan.innerText = part;
                    partSpan.onclick = () => {
                        showTree(tree, parts.slice(0, i).join('/'));
                    };
                    pathSpan.appendChild(partSpan);
                    if (i < parts.length - 1) {
                        pathSpan.innerHTML += '/';
                    }
                }
            }
            if (path) {
                let backSpan = document.createElement('div');
                backSpan.innerHTML = '⤴ 📂 ..';
                backSpan.onclick = () => {
                    showTree(tree, parts.slice(0, -1).join('/'));
                };
                contentsDiv.appendChild(backSpan);
            }
            for (let name in tree) {
                let item = tree[name];
                if (typeof item === 'object') {
                    if (item.type === 'dir') {
                        let folderSpan = document.createElement('div');
                        folderSpan.innerHTML = `↪ 📁 ${name}`;
                        folderSpan.onclick = () => {
                            showTree(item, path + '/' + name);
                        };
                        contentsDiv.appendChild(folderSpan);
                    } else if (item.type === 'file') {
                        let fileSpan = document.createElement('div');
                        fileSpan.innerHTML = `↪ 📄 ${name.replace('.md', '')}`;
                        fileSpan.onclick = () => {
                            window.location.href =
                                `https://${owner}.github.io/${repo}/${rootFolder}/${path}/${name}`.replace('.md', '');
                        };
                        contentsDiv.appendChild(fileSpan);
                    }
                }
            }
        }

        init();
    </script>

</body>

</html>